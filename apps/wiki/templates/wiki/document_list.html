{% extends "wiki/base.html" %}

{% load i18n %}

{% block extrabody %}
{{ block.super }}
<script type="text/javascript" charset="utf-8">
$(function() {
	function search(event) {
        event.preventDefault();
        var expr = new RegExp(slugify($('#file-list-filter').val()), 'i');
        $('#file-list tbody tr').hide().filter(function(index) {
            return expr.test(slugify( $('a', this).attr('data-id') ));
        }).show();
    }

    $('#file-list-find-button').click(search).hide();
	$('#file-list-filter').bind('keyup change DOMAttrModified', search);
});
</script>
{% endblock %}

{% block leftcolumn %}
	<form method="get" action="#">
    <table  id="file-list">
    	<thead>
    		<tr><th>Filtr:</th>
			<th><input autocomplete="off" name="filter" id="file-list-filter" type="text" size="40" /></th>
			<th><input type="reset" value="{% trans "Clear filter" %}" id="file-list-reset-button"/></th>
			</tr>
		</thead>
		<tbody>
    	{% for book in books %}
            <tr>
                <td><a target="_blank" data-id="{{ book.slug }}"
                    href="{% url wiki_book book.slug %}">{{ book.title }}</a>
                </td>
                <td class='listitem-tools'>
                    {% ifequal book.chunk_set.count 1 %}
                        <a target="_blank" data-id="{{ book.slug }}"
                                href="{% url wiki_editor book.slug %}">
                                [{% trans "edit" %}]</a>
                    {% else %}
                        {% for chunk in book.chunk_set.all %}
                            <a target="_blank" data-id="{{ book.slug }}"
                                href="{% url wiki_editor book.slug chunk.slug %}">
                                [<span class='chunkno'>{{ forloop.counter }}.</span>
                                {{ chunk.comment }}</a>]<br/>
                        {% endfor %}
                    {% endifequal %}
                </td>
				<!-- placeholder </td> -->
			</tr>
    	{% endfor %}
		</tbody>
    </table>
	</form>
{% endblock leftcolumn %}

{% block rightcolumn %}
	<div id="last-edited-list">
		<h2>{% trans "Your last edited documents" %}</h2>
	    <ol>
			{% for slugs, item in last_books %}
			<li><a href="{% url wiki_editor slugs.0 slugs.1 %}"
				target="_blank">{{ item.title }}</a><br/><span class="date">({{ item.time|date:"H:i:s,Â d/m/Y" }})</span></li>
			{% endfor %}
		</ol>
	</div>
{% endblock rightcolumn %}
