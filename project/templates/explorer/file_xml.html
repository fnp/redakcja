{% extends "base.html" %}

{% block extrahead %}
    <script src="/static/js/jquery.fieldselection.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/jquery.lazyload.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/codemirror/codemirror.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        function addEditorButton(label, fn) {
            $('<button type="button">' + label + '</button>').click(function(event) {
                var text = $('#id_text').getSelection().text;
                $('#id_text').replaceSelection(fn(text));
                event.preventDefault();
            }).appendTo('#buttons');
        }
        
        $(function() {
            $('#id_folders').change(function() {
                $('#images').load('/images/' + $('#id_folders').val() + '/', function() {
                    $('#images').data('lastScroll', -1000);
                });
            });
                    
            var editor = CodeMirror.fromTextArea("id_text", {
                parserfile: 'parsexml.js',
                path: "/static/js/codemirror/",
                stylesheet: "/static/css/xmlcolors.css",
                parserConfig: {useHTMLKludges: false}
            });
            
            $('iframe').load(function() {
                $($('iframe').contents()).scroll(function() {
                    var percentScrolled = $('body', this).scrollTop() / $('body', this).height();
                    $('#images-wrap').scrollTop(percentScrolled * $('#images').height());
                });
            })
            
            addEditorButton('utwór', function(text) { return '<utwor>' + text + '</utwor>'; });
            addEditorButton('akap', function(text) { return '<akap>' + text + '</akap>'; });
            
            $('#images').lazyload('.image-box', {threshold: 600});
        });

    </script>
{% endblock extrahead %}

{% block breadcrumbs %}<a href="{% url file_list %}">Platforma Redakcyjna</a> ❯ plik {{ hash }}{% endblock breadcrumbs %}

{% block maincontent %}
    <div id="tabs"><a href="{% url file_xml hash %}" class="active">Źródło</a><a href="{% url file_html hash %}">HTML</a>    <div style="padding: 3px; margin-left: 10px">{{ image_folders_form.folders }}</div><div style="clear: both; height: 0; width: 0">&nbsp;</div></div>    

    <div id="images-wrap">
        <div id="images">
            <p>Aby zobaczyć obrazki wybierz folder z obrazkami powyżej.</p>
        </div>
    </div>
    <form action="." method="post" accept-charset="utf-8">
        {# <div id="buttons"></div> #}
		<textarea id="id_text" name="text" style="width:50%; height:480px">{{ form.text.field.initial }}</textarea>
        {{ form.user.errors }}
        <p>Użytkownik: {{ form.user }}</p> 
        {{ form.commit_message.errors }}
        <p>Opis zmian: {{ form.commit_message }} <input type="submit" value="Zapisz"/></p>
    </form>
{% endblock maincontent %}    
