{% load toolbar_tags %}

<div class="change-font-size" style="">
    <div class="decrease-font-size">A<sup>-</sup></div>
    <div class="increase-font-size">A<sup>+</sup></div>
</div>

<div class="iframe-container" style="position: absolute; top: 41pt; left:0px; right:0px; bottom: 0px;">
	<textarea name="text">{{ text }}</textarea>
</div>


{% toolbar %}

<script type="text/javascript" charset="utf-8">

panel_hooks = {
	load: function () {
		var self = this;
		var panel = self.contentDiv;

        var textareaId = 'xmleditor-' + Math.ceil(Math.random() * 1000000000);
	        $('textarea', panel).attr('id', textareaId);

	var texteditor = CodeMirror.fromTextArea(textareaId, {
            parserfile: 'parsexml.js',
            path: "{{STATIC_URL}}js/codemirror/",
            stylesheet: "{{STATIC_URL}}css/xmlcolors.css",
            parserConfig: {useHTMLKludges: false},
            onChange: function() {
		self.fireEvent('contentChanged');
            },
            initCallback: function(editor) {
                // Editor is loaded
                // Buttons are connected
                // register callbacks for actions
                texteditor.grabKeys(
                    $.fbind(self, self.hotkeyPressed),
                    $.fbind(self, self.isHotkey) );
            }
        })
        
        $(texteditor.frame).css({width: '100%', height: '100%'});
        
        

        $('.decrease-font-size', panel).click(function() {
            var frameBody = $('body', $(texteditor.frame).contents());
            console.log(frameBody.css('font-size'));
            frameBody.css('font-size', parseInt(frameBody.css('font-size')) - 2);
        });
        
        $('.increase-font-size', panel).click(function() {
            var frameBody = $('body', $(texteditor.frame).contents());
            console.log(frameBody.css('font-size'));
            frameBody.css('font-size', parseInt(frameBody.css('font-size')) + 2);
        });        
        this.texteditor = texteditor;
    },

	unload: function() { 
		this.texteditor = null;
	},


	//refresh: function() { }, // no support for refresh

	saveInfo: function(saveInfo) {
		var myInfo = {
			url: "{% url file_xml fpath %}", 
			postData: {
				content: this.texteditor.getCode()
			} 
		};
		$.extend(saveInfo, myInfo);
	}		
};

</script>
